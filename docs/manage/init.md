后台管理初始化
===========

后台管理系统在首次启动时，会执行 `data.sql` 文件，自动添加初始数据，包括：数据字典表、系统设置表、初始化表等等。

---

## 数据字典表

参考：[数据字典文档](../common/dict.md)

## 系统参数表

参考：[系统设置文档](../common/setting.md)

## 初始化表

- 初始化：`sys_init`、`sys_init_step`
    - 初始化管理员
      - 以 admin 为账号，密码随机生成
      - 保存在服务器文件中并回显到页面
      - 每次登录将检测此文件是否包含初始密码
      - 如包含则提示修改密码
      - 修改密码成功删除包含初始密码的文件

数据建模：`sys_init`

| 字段名    | 注释  | 类型       | 长度  | 备注        |
|--------|-----|----------|-----|-----------|
| id     | ID  | bigint   |     | 主键、自增     |
| name   | 名称  | varchar  | 32  | 非空、唯一     |
| status | 状态  | smallint | 1   | 0 默认 1 完成 |
| sort   | 排序  | integer  | 10  | 从 0 开始、升序 |

数据建模：`sys_init_step`

| 字段名     | 注释     | 类型       | 长度  | 备注                                  |
|---------|--------|----------|-----|-------------------------------------|
| id      | ID     | bigint   |     | 主键、自增                               |
| init_id | 初始化 ID | bigint   |     | 非空、外键关联、多对一                         |
| name    | 名称     | varchar  | 32  | 非空、页面标题                             |
| path    | 模板路径   | varchar  | 64  | 导航到表单页面                             |
| action  | 表单地址   | varchar  | 255 | 后端接口接收表单数据                          |
| status  | 状态     | smallint | 1   | 0 未开始（默认）<br>1 进行中<br>2 已完成<br>3 失败 |
| tips    | 提示     | varchar  | 255 | 失败提示，帮助解决问题。<br>一般是 `i18n` 消息 key 值 |
| sort    | 排序     | integer  | 10  | 从 0 开始、升序                           |

功能逻辑：[初始化流程思维导图](/docs/manage/init.puml)

* 准备进入管理后台首页
    * 第一步 检测初始化表中是否存在未完成项目
        * 存在 执行第二步
        * 不存在 跳过初始化流程 进入管理后台首页
    * 第二步 检测未完成项目中是否存在未完成任务
        * 存在 执行第三步
        * 不存在 设置当前初始化为已完成 回到第一步
    * 第三步 根据未完成的初始化任务 设置对应的 ViewModel 实例返回
    * 第四步 根据用户提交的初始化数据 执行对应初始化逻辑
    * 第五步 设置当前任务编号为已完成 回到第一步
